<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>GLB Overwatch Viewer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>

<script src="https://cdn.babylonjs.com/babylon.js"></script>
<script src="https://cdn.babylonjs.com/loaders/babylon.glTF2FileLoader.js"></script>

<style>
html,body{margin:0;padding:0;overflow:hidden;background:#0f2a2a;}
#renderCanvas{width:100vw;height:100vh;touch-action:none;display:block;}

#hud{
position:fixed;top:12px;left:12px;
background:rgba(0,0,0,.55);
color:#dff;font-family:system-ui;
padding:12px;border-radius:12px;
}

#pad{
position:fixed;bottom:24px;left:50%;
transform:translateX(-50%);
width:160px;height:320px;
border-radius:160px;
background:rgba(255,255,255,.08);
display:grid;
grid-template-columns:1fr 1fr 1fr;
grid-template-rows:repeat(5,1fr);
gap:6px;
padding:12px;
}

.btn{
background:rgba(255,255,255,.18);
border-radius:12px;
display:flex;align-items:center;justify-content:center;
font-size:22px;color:white;
user-select:none;
}

</style>
</head>

<body>
<canvas id="renderCanvas"></canvas>

<div id="hud">
<b>FINAL HUMAN CONTROL MODEL (LOCKED)</b><br>
LOOK = drag anywhere<br>
MOVE = arrows only<br>
TAP = interact
</div>

<div id="pad">
<div></div><div class="btn" data-move="up">↑</div><div></div>
<div class="btn" data-move="left">←</div><div class="btn" data-move="forward">↖</div><div class="btn" data-move="right">→</div>
<div></div><div class="btn" data-move="backward">↙</div><div></div>
<div></div><div class="btn" data-move="down">↓</div><div></div>
</div>

<script>
const canvas=document.getElementById("renderCanvas");
const engine=new BABYLON.Engine(canvas,true);
const scene=new BABYLON.Scene(engine);
scene.clearColor=new BABYLON.Color3(0.06,0.16,0.16);

/* CAMERA — OVERWATCH */
const camera=new BABYLON.ArcRotateCamera(
"cam",
Math.PI/4,1.1,40,
BABYLON.Vector3.Zero(),
scene
);
camera.attachControl(canvas,true);
camera.panningSensibility=0;
camera.zoomOnFactor=0;
camera.wheelDeltaPercentage=0;
camera.lowerRadiusLimit=10;
camera.upperRadiusLimit=120;

/* LIGHT */
new BABYLON.HemisphericLight("h",new BABYLON.Vector3(0,1,0),scene);

/* GRID */
const grid=BABYLON.MeshBuilder.CreateGround("g",{width:200,height:200},scene);
const gridMat=new BABYLON.GridMaterial("gm",scene);
gridMat.majorUnitFrequency=10;
gridMat.minorUnitVisibility=.45;
grid.material=gridMat;

/* AVATAR */
let avatarRoot=null;
BABYLON.SceneLoader.ImportMesh(
"",
"./glb/",
"avatar.glb",
scene,
(meshes)=>{
avatarRoot=new BABYLON.TransformNode("avatar",scene);
meshes.forEach(m=>m.parent=avatarRoot);
avatarRoot.scaling.setAll(1);
avatarRoot.position.y=1;
camera.target=avatarRoot.position;
}
);

/* WORLDS */
const worlds=[
"office.glb",
"ICU.glb",
"city_pack_8.glb"
];
let worldIndex=0;
let worldRoot=null;

function loadWorld(){
if(worldRoot){worldRoot.dispose();}
BABYLON.SceneLoader.ImportMesh(
"",
"./glb/",
worlds[worldIndex],
scene,
(meshes)=>{
worldRoot=new BABYLON.TransformNode("world",scene);
meshes.forEach(m=>m.parent=worldRoot);
worldRoot.scaling.setAll(1);
worldRoot.position.set(0,0,0);
}
);
}
loadWorld();

/* MOVEMENT */
const speed=0.15;
const dirMap={
forward:new BABYLON.Vector3(0,0,1),
backward:new BABYLON.Vector3(0,0,-1),
left:new BABYLON.Vector3(-1,0,0),
right:new BABYLON.Vector3(1,0,0),
up:new BABYLON.Vector3(0,1,0),
down:new BABYLON.Vector3(0,-1,0)
};
let moveVec=BABYLON.Vector3.Zero();

document.querySelectorAll(".btn").forEach(b=>{
b.ontouchstart=()=>moveVec=dirMap[b.dataset.move];
b.ontouchend=()=>moveVec=BABYLON.Vector3.Zero();
});

scene.onBeforeRenderObservable.add(()=>{
if(!avatarRoot)return;
avatarRoot.position.addInPlace(moveVec.scale(speed));
camera.target=avatarRoot.position;
});

/* TAP = INTERACT (HOOK) */
scene.onPointerDown=()=>{
console.log("INTERACT");
};

engine.runRenderLoop(()=>scene.render());
window.addEventListener("resize",()=>engine.resize());
</script>
</body>
</html>
