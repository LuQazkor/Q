<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Babylon Avatar Loader</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>

<style>
html, body {
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
  background: #000;
  overflow: hidden;
}

#renderCanvas {
  width: 100vw;
  height: 100vh;
  display: block;
  touch-action: none;
}

#hud {
  position: fixed;
  top: 8px;
  left: 8px;
  background: rgba(0,0,0,0.8);
  color: #0f0;
  font-family: monospace;
  font-size: 12px;
  padding: 8px;
  z-index: 10;
  max-width: 90vw;
  white-space: pre-wrap;
}

#badge {
  position: fixed;
  top: 8px;
  right: 8px;
  background: #000;
  color: #0ff;
  padding: 6px 10px;
  border-radius: 14px;
  font-family: system-ui, sans-serif;
  font-size: 13px;
  z-index: 10;
}
</style>
</head>

<body>

<div id="hud">bootingâ€¦</div>
<div id="badge">Avatar Loader v4</div>
<canvas id="renderCanvas"></canvas>

<script src="https://cdn.babylonjs.com/babylon.js"></script>
<script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>

<script>
const hud = document.getElementById("hud");
function log(msg) {
  console.log(msg);
  hud.textContent += "\n" + msg;
}

log("JS alive");

const canvas = document.getElementById("renderCanvas");

const engine = new BABYLON.Engine(canvas, true, {
  preserveDrawingBuffer: true,
  stencil: true
});

log("Engine created");

const scene = new BABYLON.Scene(engine);
scene.clearColor = new BABYLON.Color4(0.2, 0.2, 0.2, 1);
log("Scene created");

// Camera (static, guaranteed visible)
const camera = new BABYLON.ArcRotateCamera(
  "cam",
  Math.PI / 2,
  Math.PI / 2,
  4,
  BABYLON.Vector3.Zero(),
  scene
);
camera.attachControl(canvas, true);
log("Camera ready");

// Light
new BABYLON.HemisphericLight(
  "light",
  new BABYLON.Vector3(0, 1, 0),
  scene
);
log("Light ready");

// TEMP DEBUG MESH (PROVES RENDERING)
const box = BABYLON.MeshBuilder.CreateBox("debugBox", { size: 1 }, scene);
box.position.y = 0.5;
log("Debug box created");

// Load avatar
const AVATAR = "glb/avatar.glb";
log("Loading " + AVATAR);

BABYLON.SceneLoader.ImportMeshAsync(
  null,
  "",
  AVATAR,
  scene
).then(res => {
  log("Avatar loaded: meshes=" + res.meshes.length);

  res.meshes.forEach(m => {
    if (m.name !== "__root__") {
      m.position.y += 0.01;
    }
  });

  // Remove debug box once avatar loads
  box.dispose();
  log("Debug box removed");

}).catch(err => {
  log("GLB ERROR");
  log(err.message || err);
});

// Render loop
engine.runRenderLoop(() => {
  scene.render();
});

// Resize
window.addEventListener("resize", () => {
  engine.resize();
});

log("Render loop started");
</script>

</body>
</html>