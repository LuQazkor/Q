<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<title>v19 ‚Äî Human Controls Locked</title>
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#0f2f2f;font-family:system-ui,-apple-system,Segoe UI}
#ui{position:fixed;top:12px;left:12px;background:rgba(0,0,0,.55);color:#fff;
padding:12px 14px;border-radius:12px;font-size:13px;line-height:1.35;max-width:88vw}
#ver{position:fixed;top:12px;right:12px;background:#000;color:#0ff;
padding:6px 10px;border-radius:999px;font-size:12px}
#movePad{
position:fixed;bottom:18px;left:50%;transform:translateX(-50%);
width:160px;height:160px;border-radius:24px;
background:rgba(255,255,255,.08);display:grid;
grid-template-columns:repeat(3,1fr);grid-template-rows:repeat(3,1fr);
gap:6px;padding:8px
}
.btn{
background:rgba(255,255,255,.12);
border-radius:12px;display:flex;align-items:center;justify-content:center;
color:#fff;font-size:18px;user-select:none;touch-action:none
}
.btn:active{background:rgba(0,255,255,.35)}
canvas{display:block}
</style>
</head>

<body>
<div id="ui">
<b>FINAL HUMAN CONTROL MODEL (LOCKED)</b><br><br>
üëÅ LOOK ‚Äî 1 finger drag anywhere<br>
üßç MOVE ‚Äî arrows only (hold to move)<br>
‚úã TAP ‚Äî touch / interact<br><br>
If your thumb presses it, your body moves.<br>
If your finger drags, your head turns.<br>
If you tap, you touch the world.
</div>
<div id="ver">v19</div>

<div id="movePad">
<div class="btn" data-move="left">‚Üê</div>
<div class="btn" data-move="forward">‚Üñ</div>
<div class="btn" data-move="right">‚Üí</div>

<div class="btn" data-move="up">‚Üó</div>
<div></div>
<div class="btn" data-move="down">‚Üò</div>

<div></div>
<div class="btn" data-move="backward">‚Üô</div>
<div></div>
</div>

<canvas id="c"></canvas>

<script src="https://cdn.jsdelivr.net/npm/three@0.159.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.159.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
/* ---------------- BASIC SCENE ---------------- */
const canvas=document.getElementById('c');
const renderer=new THREE.WebGLRenderer({canvas,antialias:true});
renderer.setSize(innerWidth,innerHeight);
const scene=new THREE.Scene();
scene.background=new THREE.Color(0x0f2f2f);

const camera=new THREE.PerspectiveCamera(65,innerWidth/innerHeight,.1,5000);
camera.position.set(0,2,6);

scene.add(new THREE.HemisphereLight(0xffffff,0x444444,1));
const dl=new THREE.DirectionalLight(0xffffff,.8);
dl.position.set(5,10,7);scene.add(dl);

/* ---------------- AVATAR ROOT ---------------- */
const avatar=new THREE.Object3D();
scene.add(avatar);

/* ---------------- LOAD GLBs (FAILSAFE) ---------------- */
const loader=new THREE.GLTFLoader();
const files=['avatar.glb','office.glb']; // auto-extend later
files.forEach((f,i)=>{
 loader.load(f,g=>{
   const obj=g.scene;
   normalize(obj);
   obj.position.set(i*6,0,0);
   scene.add(obj);
   if(i===0) avatar.add(obj);
 },undefined,()=>console.warn('failed',f));
});

/* ---------------- NORMALIZE ---------------- */
function normalize(o){
 const box=new THREE.Box3().setFromObject(o);
 const size=box.getSize(new THREE.Vector3()).length();
 const scale=2/size;
 o.scale.setScalar(scale);
 box.setFromObject(o);
 box.getCenter(o.position).multiplyScalar(-1);
}

/* ---------------- LOOK (DRAG ONLY) ---------------- */
let lookX=0,lookY=0,drag=false,px=0,py=0;
addEventListener('pointerdown',e=>{drag=true;px=e.clientX;py=e.clientY});
addEventListener('pointermove',e=>{
 if(!drag)return;
 lookX+=(e.clientX-px)*0.005;
 lookY+=(e.clientY-py)*0.005;
 lookY=Math.max(-1.3,Math.min(1.3,lookY));
 px=e.clientX;py=e.clientY;
});
addEventListener('pointerup',()=>drag=false);

/* ---------------- MOVE (BUTTONS ONLY) ---------------- */
const move={};
document.querySelectorAll('.btn').forEach(b=>{
 b.addEventListener('pointerdown',e=>{move[b.dataset.move]=true;e.preventDefault()});
 b.addEventListener('pointerup',()=>move[b.dataset.move]=false);
 b.addEventListener('pointerleave',()=>move[b.dataset.move]=false);
});

const speed=0.08;

/* ---------------- TAP = INTERACT ---------------- */
addEventListener('click',e=>{
 // placeholder interaction hook
});

/* ---------------- LOOP ---------------- */
function loop(){
 requestAnimationFrame(loop);

 camera.rotation.order='YXZ';
 camera.rotation.y=lookX;
 camera.rotation.x=lookY;

 const dir=new THREE.Vector3();
 if(move.forward) dir.z-=1;
 if(move.backward) dir.z+=1;
 if(move.left) dir.x-=1;
 if(move.right) dir.x+=1;
 if(move.up) dir.y+=1;
 if(move.down) dir.y-=1;
 dir.normalize().multiplyScalar(speed);
 avatar.position.add(dir);

 camera.position.lerp(
   avatar.position.clone().add(new THREE.Vector3(0,2,6).applyAxisAngle(new THREE.Vector3(0,1,0),lookX)),
   0.15
 );
 camera.lookAt(avatar.position);

 renderer.render(scene,camera);
}
loop();

addEventListener('resize',()=>{
 renderer.setSize(innerWidth,innerHeight);
 camera.aspect=innerWidth/innerHeight;
 camera.updateProjectionMatrix();
});
</script>
</body>
</html>
